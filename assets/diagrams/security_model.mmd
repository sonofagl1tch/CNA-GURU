%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#ffebee', 'primaryTextColor': '#c62828', 'primaryBorderColor': '#e53935', 'lineColor': '#546e7a'}}}%%

flowchart TB
    subgraph Network["üåê Network Security"]
        VPC["Private VPC"]
        SG["Security Groups"]
        ALB["Public ALB<br/>(configurable IP)"]
    end

    subgraph Encryption["üîê Encryption"]
        KMS["KMS Key<br/>(auto-rotation)"]
        S3Enc["S3 SSE-KMS"]
        TLS["TLS in Transit"]
    end

    subgraph IAM["üë§ Identity & Access"]
        AgentRole["Bedrock Agent<br/>Execution Role"]
        LambdaRoles["Lambda<br/>Execution Roles"]
    end

    subgraph DataProtection["üõ°Ô∏è Data Protection"]
        BlockPublic["S3 Block<br/>Public Access"]
        SSL["Enforce SSL<br/>on S3"]
        Versioning["S3 Versioning"]
    end

    subgraph Policies["üìú Access Policies"]
        OpenSearchPolicy["OpenSearch<br/>Data Policy"]
        BedrockPolicy["Bedrock<br/>Invoke Policy"]
    end

    %% Connections
    VPC --> SG
    SG --> ALB
    
    KMS --> S3Enc
    KMS --> TLS
    
    AgentRole --> BedrockPolicy
    LambdaRoles --> OpenSearchPolicy
    
    BlockPublic --> S3Enc
    SSL --> S3Enc
    Versioning --> S3Enc

    %% Styling
    classDef networkStyle fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#0d47a1
    classDef encryptStyle fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#e65100
    classDef iamStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#4a148c
    classDef dataStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#1b5e20
    classDef policyStyle fill:#ffebee,stroke:#c62828,stroke-width:2px,color:#b71c1c

    class VPC,SG,ALB networkStyle
    class KMS,S3Enc,TLS encryptStyle
    class AgentRole,LambdaRoles iamStyle
    class BlockPublic,SSL,Versioning dataStyle
    class OpenSearchPolicy,BedrockPolicy policyStyle
