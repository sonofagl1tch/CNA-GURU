%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e1f5fe', 'primaryTextColor': '#01579b', 'primaryBorderColor': '#0288d1', 'lineColor': '#546e7a', 'secondaryColor': '#fff3e0', 'tertiaryColor': '#f3e5f5'}}}%%

flowchart LR
    %% User Entry Point
    User["ðŸ§‘â€ðŸ’» Security Analyst"]

    subgraph Frontend["ðŸ–¥ï¸ Web Interface"]
        direction TB
        ALB["Load Balancer"]
        App["Streamlit App"]
    end

    subgraph Processing["âš¡ Processing Layer"]
        direction TB
        InvokeFn["Invoke Function"]
        ActionFn["Action Function"]
    end

    subgraph AI["ðŸ¤– AI Engine"]
        direction TB
        Agent["Bedrock Agent"]
        KB["Knowledge Base"]
        LLM["Claude 3 Sonnet"]
    end

    subgraph Data["ðŸ’¾ Data Storage"]
        direction TB
        Docs["ðŸ“„ CWE Documents"]
        Vector["ðŸ” Vector Search"]
    end

    %% Main Flow - Left to Right
    User --> ALB
    ALB --> App
    App --> InvokeFn
    InvokeFn --> Agent
    Agent --> LLM
    Agent --> KB
    Agent --> ActionFn
    KB --> Docs
    KB --> Vector

    %% Styling
    classDef userStyle fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px,color:#1b5e20
    classDef frontendStyle fill:#e3f2fd,stroke:#1565c0,stroke-width:2px,color:#0d47a1
    classDef processingStyle fill:#fff3e0,stroke:#ef6c00,stroke-width:2px,color:#e65100
    classDef aiStyle fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px,color:#4a148c
    classDef dataStyle fill:#e8f5e9,stroke:#388e3c,stroke-width:2px,color:#1b5e20
    classDef subgraphStyle fill:#fafafa,stroke:#9e9e9e,stroke-width:1px

    class User userStyle
    class ALB,App frontendStyle
    class InvokeFn,ActionFn processingStyle
    class Agent,KB,LLM aiStyle
    class Docs,Vector dataStyle
